<!DOCTYPE HTML>
<html>
<head>
  <title>{$menu_name}</title>
  <!--#include file="public/header_top.html"-->
  <script src="__PUBLICURL__/js/Chart.js"></script>
</head>
<body>
<div id="wrapper">
  <!--#include file="public/header.html"-->
  <div id="page-wrapper">
    <div class="graphs">
      <div class="graph_box1">
        <div class="col-md-6 grid_2"><div class="grid_1">
          <h3>最近一年每月做题数和做对题数</h3>
          <canvas id="bar" height="300" width="600" style="width: 600px; height: 300px;"></canvas>
          <div class="col-sm-2" id="num">
            <select name="bookChapters" id="bookChapters" class="form-control1" onchange="getChapters()">
              <!--foreach:{$bookChapters $l}-->
              <option value="{$l.bookChaptersId}">{$l.bookChaptersName}</option>
              <!--{/foreach}-->
            </select>
          </div>
        </div></div>
        <div class="col-md-6 grid_2"><div class="grid_1">
          <h3>Pie</h3>
          <canvas id="pie" height="300" width="600" style="width: 600px; height: 300px;"></canvas>
        </div></div>
        <!--<div class="col-md-6 grid_2"><div class="grid_1">
          <h3>Line</h3>
          <canvas id="line" height="300" width="600" style="width: 600px; height: 300px;"></canvas>
        </div></div>-->
        <div class="clearfix"> </div>
      </div>
      <div class="bs-example4" data-example-id="contextual-table">
        <table class="table">
          <thead>
          <tr>
            <th>ID</th>
            <th>课本章节名称</th>
            <th>正确率</th>
            <th>题数</th>
            <th>操作</th>
          </tr>
          </thead>
          <tbody id="bookChaptersList">
          <!--foreach:{$list $l}-->
          <tr id="{$l.bookChaptersId}" class="active">
            <th scope="row">{$l.bookChaptersId}<input type="hidden" id="indent{$l.bookChaptersId}" value="1"></th>
            <td>{$l.bookChaptersName}</td>
            <td>{$l.errorRate}</td>
            <td>{$l.questionsNum}</td>
            <td><a href="javascript:void(0)" class="unfurled{$l.bookChaptersId}" onclick="unfurled({$l.bookChaptersId})">展开</a></td>
          </tr>
          <!--{/foreach}-->
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <script>
    function barList(labels)
    {
        var barlist=new Array();
        var data1=new Array();
        var data2=new Array();
        $.each(labels,function(k,v){
            barlist.push(v.num);
            data1.push(v.snum);
            data2.push(v.znum);
        });
        var barChartData = {
            labels : barlist,
            datasets : [
                {
                    fillColor : "#ef553a",
                    strokeColor : "#ef553a",
                    data : data1
                },
                {
                    fillColor : "#00aced",
                    strokeColor : "#00aced",
                    data : data2
                }
            ]

        };
        new Chart(document.getElementById("bar").getContext("2d")).Bar(barChartData);
    }
    barList({$barlist});
    function getChapters()
    {
        var bookChaptersId=$("#bookChapters").val();
        $.ajax({
            url:"__APP__/learnEmphases/ajaxGetSubject",
            type:'post',
            data:"bookChaptersId="+bookChaptersId,
            dataType:'json',
            success:function(d){
                barList(d);
            }
        });
    }
    function unfurled(id)
    {
        var gradeId=$("#gradeId").val();
        var unfurleds=$(".unfurled"+id).html();
        var indent=$("#indent"+id).val();
        var indents="";
        for(var i=0;i<indent*1;i++)
        {
            if(i==indent-1)
            {
                indents=indents+"┕╍╍ ";
            }else{
                indents=indents+"&nbsp;&nbsp;&nbsp;&nbsp;";
            }
        }
        indent=indent*1+1;
        if(unfurleds=='展开')
        {
            $.ajax({
                url:"__APP__/learnEmphases/ajaxChapters",
                type:'post',
                data:"bookChaptersId="+id,
                dataType:'json',
                success:function(d){
                    var str="";
                    var class_s=$("#"+id).attr("class");
                    class_s=class_s+" bookChaptersId"+id;
                    $.each( d, function(index, content){
                        var op="";
                        if(content.status==1)
                            op='| <a href="javascript:void(0)" class="unfurled'+content.bookChaptersId+'" onclick="unfurled('+content.bookChaptersId+')">展开</a>';
                        str=str+'<tr id="'+content.bookChaptersId+'" class="'+class_s+'"><th scope="row">'+content.bookChaptersId+'<input type="hidden" id="indent'+content.bookChaptersId+'" value="'+indent+'"></th><td>'+indents+" "+content.bookChaptersName+'</td><td>'+content.errorRate+'</td><td>'+content.questionsNum+'</td><td>'+op+'</td> </tr>';
                    });
                    $("#"+id).after(str);
                    $(".unfurled"+id).html("收起");
                }
            });
        }else{
            $(".bookChaptersId"+id).remove();
            $(".unfurled"+id).html("展开");
        }
    }
      var pieData = [
          {
              value: 30,
              color:"#ef553a"
          },
          {
              value : 50,
              color : "#00aced"
          },
          {
              value : 100,
              color : "#69D2E7"
          }

      ];
      new Chart(document.getElementById("pie").getContext("2d")).Pie(pieData);
      /*var lineChartData = {
          labels : ["","","","","","",""],
          datasets : [
              {
                  fillColor : "#00aced",
                  strokeColor : "#00aced",
                  pointColor : "#00aced",
                  pointStrokeColor : "#fff",
                  data : [65,59,90,81,56,55,40]
              },
              {
                  fillColor : "#3b5998",
                  strokeColor : "#3b5998",
                  pointColor : "#3b5998",
                  pointStrokeColor : "#fff",
                  data : [28,48,40,19,96,27,100]
              }
          ]

      };
      new Chart(document.getElementById("line").getContext("2d")).Line(lineChartData);*/
  </script>
  <!-- /#page-wrapper -->
</div>
<!-- /#wrapper -->
<!-- Bootstrap Core JavaScript -->
<script src="__PUBLICURL__/kg/js/bootstrap.min.js"></script>
</body>
</html>
